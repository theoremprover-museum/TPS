\chapter{Output: Symbols, Files and Styles}
\label{output}

\section{Proofwindows}

If proofwindows have been opened (with the \indexcommand{BEGIN-PRFW}
command), then proofs or parts of proofs which have been produced
automatically may not automatically appear in the proofwindows.
The command \indexcommand{PSTATUS} can then be
used to update these windows appropriately.  There are also three
associated flags, \indexflag{PROOFW-ALL}, \indexflag{PROOFW-ACTIVE+NOS} and
\indexflag{PROOFW-ACTIVE}, which control the output to the `Complete
Proof', `Current Subproof and Line Numbers'
and `Current Subproof' windows respectively; when one of these
flags is NIL, no output goes to the relevant window, and when the flag
is T then output resumes. All these flags are set to T by default.

To make proofwindows work properly, the unix DISPLAY variable must have
been properly initialized. (For example, if you are working on
btps.tps.cs.cmu.edu, but proofwindows do not appear when they should,
try doing {\it setenv DISPLAY btps.tps.cs.cmu.edu:0.0} before starting up TPS.)


\section{Interpreting the Output from Mating Search}

\subsection{Symbols Printed by Mating Search}
Mating search outputs a number of special symbols; it isn't necessary to know what they mean,
but this section is provided for those who are curious.
Some of these symbols are replaced by more informative messages if \indexflag{MATING-VERBOSE}
is set to {\tt MAX} or {\tt MED}; conversely, if \indexflag{MATING-VERBOSE} is {\tt SILENT} they
may not be printed at all. Furthermore, those which are labelled (EVENTS) are generated by the events package,
and will not be printed unless events are switched on.

Unification also outputs special symbols (if \indexflag{UNIFY-VERBOSE} is set high enough);
Again, some of these symbols are replaced by more informative messages if \indexflag{UNIFY-VERBOSE}
is set to {\tt MAX} or {\tt MED}; conversely, if \indexflag{UNIFY-VERBOSE} is {\tt SILENT} they
may not be printed at all.

The symbols are as follows:
\begin{itemize}
\item {\bf *} means that the mating search is considering a connection (EVENTS).

\item {\bf +} means that a connection is being added (EVENTS).

\item {\bf -} means that a connection is being removed (EVENTS).

\item {\bf 2} means that a quantifier (or every quantifier) is being duplicated (EVENTS).

\item {\bf P} means that primitive substitutions are being applied (EVENTS).

\item {\bf \%} means that the current mating is not unifiable (EVENTS).

\item {\bf MST} means that a mating is being tested for subsumption (EVENTS).

\item {\bf MSS} means that a mating is subsumed by an incompatible or inextensible mating (EVENTS).

\item {\bf UST} means that the disagreement pairs are being tested for subsumption (EVENTS).

\item {\bf USS} means that the disagreement pairs are subsumed by a previous set of dpairs (EVENTS).

\item {\bf M} means that a connection has been rejected because \indexflag{MAX-MATES} is too low.

\item {\bf B} means that a connection has been rejected because it is banned (currently, this can only happen
if a gwff has been rewritten in two different ways: connections between leaves of the two rewrites are
marked as `banned').

\item {\bf .} means we could interrupt at this point; see section \ref{interrupt} for details.

\item {\bf C} means that a complete (but not necessarily unifiable) mating has been found.

\item {\bf s} means that unification is giving up on a branch of the unification tree because
\indexflag{MAX-SEARCH-DEPTH} has been exceeded.

\item {\bf u} denotes the same thing for \indexflag{MAX-UTREE-DEPTH}.

\item {\bf S} denotes the same thing for \indexflag{MAX-SUBSTS-VAR}.

\item {\bf F} means that unification has failed, and the search will now backtrack.

\item {\bf R} means that a rigid path check has succeeded.

\item {\bf ?} means that unification subsumption check has found a possible subsumed node and is checking further.

\item {\bf !} means that unification subsumption check has eliminated a subsumed node.

\item {\bf 0-1-0-2} or a similar string of digits separated by hyphens denote new unification
nodes being created. This particular example would be a new node which is the second son of the
only son of the first son of the root of the unification tree.
\end{itemize}

Other messages you may see (apart from the self-explanatory ones) are as follows:

In non-path-focused searches, the current path is often shown; this is simply the
leftmost open path, which {\TPS} is currently trying to block.

In path-focused duplication, the current mating is shown on occasion (the
actual frequency is determined by the flag \indexflag{PRINT-MATING-COUNTER}).
In these matings, the connection: LEAF19 . LEAF17    4 . 3
is between copy 4 of the innermost universal quantifier with LEAF 19 in its scope,
and copy 3 of the innermost universal quantifier with LEAF 17 in its scope.
A copy number of -1 indicates the sole occurrence of a literal which is not
in the scope of any quantifier.

Also in path-focused duplication, one may see timing statistics like:
\begin{alltt}
Timing statistics for mating-search:
Evaluation took:
  2.64 seconds of real time,			A
  0.96875 seconds of user run time,		B
  0.1875 seconds of system run time,		C
\end{alltt}
In these, B is the significant number, C is the amount of time taken up by paging,
etc, and A is at least the sum of B and C. These timing figures are usually
noticeably lower than the `official' figures produced by
\indexcommand{DISPLAY-TIME}.

\input{monitor}


\section{Output files}

{\TPS} writes files into a directory determined by the value of the Lisp
function user-homedir-pathname; this function (presumably) gets the
value from the \$HOME environment variable.

See the {\ETPS} manual \cite{AndrewsTPS88b} for basic information on using the
commands \indexcommand{TEXPROOF}, \indexcommand{SCRIBEPROOF} and
\indexcommand{PRINTPROOF} to print proofs into files. {\TPS} has internal
modes called \indexother{SCRIBE-OTL}, \indexother{TEX-OTL} and
\indexother{TEX-1-OTL} which it uses by default for printing proofs into
Scribe and TeX files. These modes are generally good enough for the job, although
it is possible to turn them off (in order to use your own flag settings)
by setting \indexflag{USE-INTERNAL-PRINT-MODE} to NIL.

Printed output of wffs is designed so that a wff in a proof never extends
further left than the turnstile preceding it. If \indexflag{TURNSTILE-INDENT-AUTO}
is MIN, COMPRESS or VARY, and some lines have very long hypotheses, the
turnstile can end up moving a long way to the right, and this will mean
that some wffs have to be crammed into only a few columns. This can produce
very strange-looking output, so if you have many hypotheses and long wffs, it's probably best to set
\indexflag{TURNSTILE-INDENT} to, say, 5 and \indexflag{TURNSTILE-INDENT-AUTO} to FIX.
This will force the turnstile to always be in column 5, by inserting a newline if necessary.
You may also want to set \indexflag{USE-INTERNAL-PRINT-MODE} to NIL,
\indexflag{FILLINEFLAG} to T, \indexflag{FLUSHLEFTFLAG} to T,
and \indexflag{PPWFFLAG} to NIL in this case.

The editor commands \indexedop{VPF} and \indexedop{VPT} allow you to save vertical
path diagrams in generic and TeX styles, respectively.

\section{Output styles}
The value of the flag \indexflag{STYLE} determines how wffs are to be printed.
The styles which are most useful for printing on a terminal are
\indexstyle{GENERIC}, \indexstyle{CONCEPT-S} and \indexstyle{XTERM}.
The first of these uses no special characters.
The other two are useful only when using {\TPS} on a Concept terminal or inside an
xterm window under the X window system, respectively.  When these styles are used,
special characters for
logical connectives, constants, and type symbols are printed on the screen,
making output more readable.  See section \ref{X} for how to use {\TPS}
with the X window system.

The styles \indexstyle{SCRIBE} and \indexstyle{TEX} are used for printing output
in a form which is acceptable to those typesetting systems. Most {\TPS} output
can be produced in either of these two styles, although vertical path diagrams
in Scribe are not pretty at all. Documentation produced by commands like
\indexcommand{QUICK-REF} is always in Scribe format.


\section{Saving Output from Mating Search}

{\TPS} has several available methods of storing output from the mating-search.
The \indexmexpr{SCRIPT} command will record a transcript of the session
(this, of course, will record everything you do, not just the mating-search).
If you are creating a script file, you may wish to do {\tt style generic} in
order to make the output more readable; if you are working on a
Concept keyboard, change this to {\tt style concept-s}. The \indexcommand{SCRIPT} command
will add Scribe or TeX headers to the resulting file, if the \indexflag{STYLE} flag
is either {\tt SCRIBE} or {\tt TEX}.
The \indexmexpr{UNSCRIPT} command
will close the script file. The \indexmexpr{SCRIPT} command is intended
to mimic the Unix command {\it script}, and one can also call the Unix
{\it script} before running {\TPS} (this will even save bug messages which come from
Lisp, which the {\TPS} command SCRIPT will not do; however, one should be careful
to ensure that the Unix command is recording the
output from the correct window, if one is running X windows!).
The script file can be viewed using the Unix {\it cat} command.

A list of all the events (duplication, etc) which occur during mating-search
can be saved to a file by setting the flags \indexflag{REC-MS-FILE} to T,
\indexflag{REC-MS-FILENAME} to a file name and \indexflag{INTERRUPT-ENABLE} to T.
This only works for non-path-focused procedures.

More usefully (if you are running {\TPS} under X-windows or using the Java interface),
when using \indexcommand{DIY} or when entering the
\indexcommand{MATE} top level you will be offered the chance to open a vpform
window. You can also open this window manually with the \indexcommand{OPEN-MATEVPW}
command, and you can close it with \indexcommand{CLOSE-MATEVPW}. The output of
the window may be discarded, or may be saved to a file for future reference.
If the vpform window is open, then every time {\TPS} prints a vpform to the main
window, it will send a copy to the vpform window. In the mating-search, it will
also send copies of the associated substitutions to the vpform window, and if
the mating-search terminates then the complete mating will also be sent there.

Thus the vpform window and/or file will contain a record of the entire search;
since this window is just an xterm, one can scroll about in it while the search is
still proceeding without risking any information being lost.
Scribe or TeX headers will be added to the resulting file automatically, if the
\indexflag{STYLE} flag is either {\tt SCRIBE} or {\tt TEX}.

The file can be viewed again by using the \indexcommand{DISPLAYFILE} command
within {\TPS}, or by using the \indexother{vpshow} utility from a Unix prompt.
The vpshow utility is provided as part of the {\TPS} system; look for the directory
{\it tps/utilities}, which should contain the files \indexfile{vpshow} and
\indexfile{vpshow-big}; just type {\tt vpshow {\it filename}} to view the file.

\section{Interrupting TPS for Occasional Output}

The \indexcommand{PUSH} and \indexcommand{POP} commands are very useful here. By setting
the flags so that {\TPS} pauses for input during a mating search or translation, one can
interrupt the program for long enough to print out a proof or vertical path diagram
before continuing. For example, setting \indexflag{QUERY-USER} to {\tt QUERY-JFORMS} makes
{\TPS} ask whether to search on each new jform it generates during a mating search. Instead
of replying yes or no, reply {\tt PUSH}; this will start a new top level from which you can
print the vpform (for example) before typing {\tt POP} to continue the search.
The monitor function \indexcommand{PUSH-MATING} is also useful in this context; see the help
message for more details.

Similarly, by using \indexcommand{ETREE-NAT} in {\tt INTERACTIVE} mode, you can use
{\tt PUSH} and {\tt POP} to produce `snapshots' of a natural deduction proof as it is
constructed from an expansion proof. (You
can also use a suitable setting of \indexflag{ETREE-NAT-VERBOSE} and edit the resulting
output for much the same effect.)

\section{Output for Slides}

\indexcommand{SLIDEPROOF} is like \indexcommand{SCRIBEPROOF}, but prints
proofs in the vpstyle \indexstyle{SCRIBE-SLIDES}. You may need to adjust the flags
\indexflag{SLIDES-TURNSTYLE-INDENT} (set it to 6 if there is at most one
hypothesis per line), \indexflag{PRINTEDTFLAG-SLIDES},
\indexflag{FILLINEFLAG} and \indexflag{PPWFFLAG}.

You can make slides for Scribe of a session with {\TPS} as follows:

\begin{tpsexample}
<0>save-work file1
{\it Do what you want to do in tps}
<100>stop-save
<101>setup-slide-style		
{\it This sets rightmargin and sets style to scribe
Actually you may need to set rightmargin to 45 instead of 51.
Try setting the margins in the scribe heading below smaller.
If there are just a few lines that are too long, edit them.
Also perhaps change the settings of PPWFFLAG and FILLINEFLAG.}
<102>execute-file
COMFIL (FILESPEC): SAVE-WORK file [`work.work']file1
EXECPRINT (YESNO): Execute Print-Commands? [No]>y
OUTFIL (FILESPEC): Output file (`NUL:' to discard) [`TTY']>`file2.mss'
{\it then leave tps}
\end{tpsexample}

You should then edit the resulting Scribe file, adding the following
header:

\begin{alltt}
jmake(slides)
juse(Database `/afs/cs/project/tps/pmax/doc/lib')
jmodify(verbatim, spacing 2, linewidth 51)
jstyle(rightmargin = .25in)
jstyle(leftmargin = .25in)
jlibraryfile(tps18)
jPageFooting(Immediate,  Center  <\value{Page}>)
jBegin(Verbatim)
\end{alltt}

and add {\tt jend(verbatim}) at the end. You can, of course, edit the body
of the file as necessary.

\section{Record files}
To make a script of a session with TPS which you can examine
later, proceed as follows:
\begin{alltt}
\%script {\it filename}		
\%tps				enter TPS
<0>setflag style {\it style}
				do what you wish in TPS
<9>exit				exits TPS
\%exit				exits the script session
\end{alltt}

Notice that the above uses the Unix \indexcommand{script} command, which records all the
output from a particular shell; this will not work if you are using an xterm window
(i.e. if you have aliased the `tps' command so that it starts a new shell in a new window
and runs {\TPS} there, then nothing will be recorded to the script file).

Alternatively (and this will work in all cases), use the command \indexmexpr{SCRIPT}
in {\TPS} to start a script file, as follows:
\begin{alltt}
<0>setup-slide-style
{\it if you want output for overhead projector slides; otherwise omit this.}
<1>style {\it style}
{\it choose your output style for the main window.}
<2)window-style {\it style}
{\it choose your output style for the vpwindow and other windows.}
<3>script {\it filename}
{\it start an output file for the main window.}
{\it ....
do what you wish in TPS (you can opt to save output from vpwindows when they are opened}.)
<9>unscript
{\it close the output file for the main window.}
<10>close-matevpw
{\it if you haven't already closed it.}
<11>exit
{\it exits TPS.}
\end{alltt}

The command \indexmexpr{UNSCRIPT} will close the most recently opened script file.
(Warning: At the time of writing, there was a bug in the {\tt SCRIPT} command
in that if a script file is started from a sub-top-level such as {\tt mate}, the
file will be closed without warning when you leave. So always use {\tt SCRIPT}
from the main top level.)

The value of the flag {\tt STYLE} should be set ({\it before} you issue the \indexmexpr{SCRIPT} command,
so that the file will get the correct header on it) to either {\tt GENERIC}, {\tt TEX}, {\tt SCRIBE},
{\tt CONCEPT-S}, or {\tt XTERM}, depending upon what use you plan for the
file:
\begin{description}
\item[] If you need to print out a copy of your session, use
{\tt GENERIC}, {\tt TEX} or {\tt SCRIBE}. To produce output for
use as overhead projector slides, use the command \indexmexpr{SETUP-SLIDE-STYLE} before starting the
script file;
this produces output in {\tt SCRIBE} format, so vpforms will be badly formatted, but
everything else will be correct. The style {\tt SCRIBE} can also be used to produce
regular printable output in {\tt SCRIBE} format. If you are using the automatic
procedures, it may be best to set \indexflag{STYLE} to {\tt TEX} (and possibly also opt to save the vpwindow
output to a separate file). This works best because the only style
in which vpforms are printed correctly is {\tt TEX}. Note that the mating procedures output
some characters that will confuse TeX (notably <, > and \#), and so the resulting files will still
need a certain amount of editing before they are entirely correct.
Better yet, you can set the \indexflag{WINDOW-STYLE} flag to {\tt TEX} and the \indexflag{STYLE}
flag to {\tt SCRIBE} for the best of both worlds; output to the vpwindow will be saved in
style {\tt TEX}, in a separate file to the main output which will be saved in style {\tt SCRIBE};
this way you get everything formatted correctly all at once.

\item[] Output files in style {\tt GENERIC} will be printable immediately, without any editing,
although they may be a little difficult to read if you are printing a lot of wffs.

\item[] The other two settings ({\tt CONCEPT-S} and {\tt XTERM}) should be used if you wish to `play back'
the file as a demonstration on a Concept with special characters or
in an xterm window with the special boldface font vtsymbold.
The resulting script file will not be human-readable in its raw form, but you can play it back
using the Unix command `more {\it filename}',
or by using the {\it vpshow} command (from a shell), or with the \indexmexpr{DISPLAYFILE} command
from within {\TPS}.
\end{description}


